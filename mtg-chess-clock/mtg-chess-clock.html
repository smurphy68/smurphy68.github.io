<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>It's a Goddamn Magic Clock</title>
    <style>
        body {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-gap: 10px;
            height: 100vh;
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
        }

        .player {
            text-align: center;
            padding: 20px;
            border: 2px solid #000;
            background-color: #fff;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }

        .flip {
            transform: rotate(180deg);
        }

        .clock {
            font-size: 2rem;
            color: #333;
        }

        .button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
        }

        .button:hover {
            background-color: #0056b3;
        }

        .bottom-controls {
            grid-column: span 2;
            text-align: center;
            position: absolute;
            bottom: 10px;
            left: 0;
            right: 0;
        }

        .life-counter {
            font-size: 1.5rem;
            margin-top: 10px;
        }

        /* Toggle switch styles */
        .switch-label {
            font-size: 1rem;
            display: inline-block;
            margin-right: 10px;
            color: #333;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: #fff;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        @media screen and (max-width: 768px) {
            .player {
                padding: 15px;
            }

            .clock {
                font-size: 1.5rem;
            }

            .button {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="player flip">
        <p>Player 1</p>
        <div class="clock" id="player1Clock">00:00</div>
        <div class="life-counter">
            <button class="button" onclick="adjustLife(1, 1)">+</button>
            <span id="player1Life">40</span>
            <button class="button" onclick="adjustLife(1, -1)">-</button>
        </div>
        <button class="button" onclick="passTurn(1)">Pass Turn</button>
        <div class="bottom-controls">
            <input type="number" id="initialTime" placeholder="Initial Time (minutes)">
            <button class="button" onclick="startClock()">Start</button>
            <button class="button" onclick="resetClock()">Reset</button>
            <label class="switch-label" for="togglePlayers">Flip</label>
            <label class="switch">
                <input type="checkbox" id="togglePlayers">
                <span class="slider round"></span>
            </label>
        </div>
    </div>
    <div class="player flip">
        <p>Player 4</p>
        <div class="clock" id="player4Clock">00:00</div>
        <div class="life-counter">
            <button class="button" onclick="adjustLife(2, 1)">+</button>
            <span id="player4Life">40</span>
            <button class="button" onclick="adjustLife(2, -1)">-</button>
        </div>
        <button class="button" onclick="passTurn(4)">Pass Turn</button>
    </div>
    <div class="player">
        <p>Player 2</p>
        <div class="clock" id="player2Clock">00:00</div>
        <div class="life-counter">
            <button class="button" onclick="adjustLife(4, 1)">+</button>
            <span id="player2Life">40</span>
            <button class="button" onclick="adjustLife(4, -1)">-</button>
        </div>
        <button class="button" onclick="passTurn(2)">Pass Turn</button>
    </div>
    <div class="player">
        <p>Player 3</p>
        <div class="clock" id="player3Clock">00:00</div>
        <div class="life-counter">
            <button class="button" onclick="adjustLife(3, 1)">+</button>
            <span id="player3Life">40</span>
            <button class="button" onclick="adjustLife(3, -1)">-</button>
        </div>
        <button class="button" onclick="passTurn(3)">Pass Turn</button>
    </div>

    <script>
        let currentPlayer = 1;
        let playerTimes = [0, 0, 0, 0];
        let playerElapsedTimes = [0, 0, 0, 0];
        let interval;
        let initialTimeMinutes = 0;

        let playerLifeTotal = [40, 40, 40, 40];

        function formatTime(time) {
            const minutes = Math.floor(time / 60);
            const seconds = time % 60;
            return `${minutes < 10 ? '0' : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function updateClocks() {
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`player${i}Clock`).textContent = formatTime(playerTimes[i - 1]);
            }
        }

        function updateLifeCount(player) {
            document.getElementById(`player${player}Life`).textContent = playerLifeTotal[player - 1];
        }

        function startClock() {
            document.getElementById('togglePlayers').disabled = true;
            clearInterval(interval);
            if (initialTimeMinutes === 0) {
                initialTimeMinutes = parseInt(document.getElementById('initialTime').value, 10) || 0;
            }

            for (let i = 0; i < playerTimes.length; i++) {
                playerTimes[i] = initialTimeMinutes * 60 - playerElapsedTimes[i];
            }

            interval = setInterval(() => {
                playerTimes[currentPlayer - 1]--;
                playerElapsedTimes[currentPlayer - 1]++;
                if (playerTimes[currentPlayer - 1] < 0) {
                    clearInterval(interval);
                    alert(`Player ${currentPlayer} has run out of time!`);
                }
                updateClocks();
            }, 1000);
        }

        function resetClock() {
            clearInterval(interval);
            document.getElementById('togglePlayers').disabled = false;
            playerTimes = [0, 0, 0, 0];
            playerElapsedTimes = [0, 0, 0, 0];
            currentPlayer = 1;
            document.getElementById('initialTime').value = '';
            initialTimeMinutes = 0;
            updateClocks();

            playerLifeTotal = [40, 40, 40, 40]
            updateLifeCount(1);
            updateLifeCount(2);
            updateLifeCount(3);
            updateLifeCount(4);
        }

        function passTurn(player) {
            if (player === currentPlayer) {
                clearInterval(interval);
                let targetPlayer;
                targetPlayer = player % 4 + 1;
                currentPlayer = targetPlayer;
                startClock();
            }
        }

        function adjustLife(player, delta) {
            playerLifeTotal[player - 1] += delta;
            if (playerLifeTotal[player - 1] < 0) {
                playerLifeTotal[player - 1] = 0;
            }
            updateLifeCount(player);
        }

        updateClocks(); // Initialize clocks with 00:00
        updateLifeCount(1); // Initialize life counts
        updateLifeCount(2);
        updateLifeCount(3);
        updateLifeCount(4);

        document.getElementById('togglePlayers').addEventListener('change', function () {
            // Toggle the positions of Player 1 and 2, and Player 3 and 4
            const player1 = document.querySelector('.player:nth-child(1)');
            const player2 = document.querySelector('.player:nth-child(2)');
            const player3 = document.querySelector('.player:nth-child(3)');
            const player4 = document.querySelector('.player:nth-child(4)');
            
            // Check if the switch is checked
            if (this.checked) {
                // Swap Player 1 and Player 2
                player1.style.order = 2;
                player2.style.order = 1;
                // Swap Player 3 and Player 4
                player3.style.order = 4;
                player4.style.order = 3;
            } else {
                // Reset the order
                player1.style.order = 1;
                player2.style.order = 2;
                player3.style.order = 3;
                player4.style.order = 4;
            }
        });
    </script>
</body>
</html>